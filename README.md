# üçå Minion - HTTP API –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ iiko

BELLO! HTTP API —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å iiko —Å–∏—Å—Ç–µ–º–∞–º–∏. –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.20+
- AWS CLI –Ω–∞—Å—Ç—Ä–æ–µ–Ω (`aws configure`)
- –î–æ—Å—Ç—É–ø –∫ AWS Secrets Manager
- MongoDB –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd minion

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
go mod tidy

# –°–æ–∑–¥–∞–µ–º .env —Ñ–∞–π–ª
cp env.example .env

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env —Ñ–∞–π–ª
nano .env
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`:

```bash
HTTP_PORT=3000
AWS_REGION=eu-west-1
AWS_SECRET_NAME=ProdEnvs
```

AWS —Å–µ–∫—Ä–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
```json
{
  "db_url": "mongodb://username:password@host:port/database",
  "db_name": "database_name",
  "db_engine": "mongodb"
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
go build -o bin/minion ./cmd/minion

# –ó–∞–ø—É—Å–∫ HTTP API —Å–µ—Ä–≤–µ—Ä–∞
./bin/minion
# –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
go run ./cmd/minion
```

**HTTP API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| `GET` | `/api/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è API |
| `GET` | `/api/config` | –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
| `POST` | `/api/extend-keys` | –ü—Ä–æ–¥–ª–µ–Ω–∏–µ API –∫–ª—é—á–µ–π |
| `POST` | `/api/refresh-menus` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é |

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
curl http://localhost:3000/api/health

# –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π
curl -X POST http://localhost:3000/api/extend-keys

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é
curl -X POST http://localhost:3000/api/refresh-menus
```

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "success": true,
  "message": "üéâ GELATO! –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 5 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤",
  "data": {
    "processed_restaurants": 5,
    "successful": 4,
    "failed": 1,
    "duration": "2.5s",
    "details": [
      {
        "name": "–†–µ—Å—Ç–æ—Ä–∞–Ω 1",
        "success": true,
        "updated": 3,
        "message": "–û–±–Ω–æ–≤–ª–µ–Ω–æ 3 –∫–ª—é—á–µ–π"
      }
    ]
  }
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `HTTP_PORT` | –ü–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞ | `3000` |
| `AWS_REGION` | AWS —Ä–µ–≥–∏–æ–Ω | `eu-west-1` |
| `AWS_SECRET_NAME` | –ò–º—è —Å–µ–∫—Ä–µ—Ç–∞ –≤ AWS | `ProdEnvs` |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–∂–∏–¥–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é `restaurants` –≤ MongoDB —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```javascript
{
  "_id": ObjectId,
  "name": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞",
  "pos_type": "iiko",
  "is_deleted": false,
  "iiko_cloud": {
    "custom_domain": "restaurant.iikoweb.ru",
    "login": "iiko_login",
    "password": "iiko_password",
    "organization_id": "...",
    "terminal_id": "...",
    "key": "..."
  },
  "settings": {
    "is_deleted": false
  }
}
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (KISS –ø—Ä–∏–Ω—Ü–∏–ø)

```
cmd/minion/           - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (—Ç–æ–ª—å–∫–æ HTTP —Å–µ—Ä–≤–µ—Ä)
internal/
‚îú‚îÄ‚îÄ aws/             - AWS Secrets Manager –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ client/          - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è iiko API
‚îú‚îÄ‚îÄ config/          - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
‚îú‚îÄ‚îÄ database/        - MongoDB —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ handlers/        - HTTP API handlers (Fiber)
‚îú‚îÄ‚îÄ server/          - HTTP —Å–µ—Ä–≤–µ—Ä (Fiber)
‚îî‚îÄ‚îÄ models/          - –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
```

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –°–±–æ—Ä–∫–∞
go build -o bin/minion ./cmd/minion

# –ó–∞–ø—É—Å–∫
go run ./cmd/minion

# –¢–µ—Å—Ç—ã
go test ./...

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
go fmt ./...

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
go vet ./...

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod tidy
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- üîê AWS Secrets Manager –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è credentials
- üö´ `.env` —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore`
- üë• –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ iiko credentials –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
- üîÑ –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞
- üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ —Å IP –∞–¥—Ä–µ—Å–∞–º–∏

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **Fiber v2** - HTTP –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **godotenv** - –ó–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–æ–≤
- **AWS SDK** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AWS Secrets Manager
- **MongoDB Driver** - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB

üçå **BELLO!** –ü—Ä–æ—Å—Ç–æ–π HTTP API –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ iiko —Å–∏—Å—Ç–µ–º! **BANANA!** üéâ